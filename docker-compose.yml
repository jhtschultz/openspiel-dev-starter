# Local development setup
# Usage: docker compose up -d && docker compose exec dev bash

services:
  dev:
    image: gcr.io/${PROJECT_ID}/openspiel-dev:latest
    container_name: openspiel-dev
    
    # Keep container running
    stdin_open: true
    tty: true
    
    volumes:
      # Mount your code - edits persist, no rebuild needed
      - ./open_spiel:/home/dev/open_spiel
      
      # CRITICAL: Persist build artifacts across container restarts
      # First build is slow, subsequent builds are incremental
      - build-cache:/home/dev/open_spiel/build
      
      # Mount experiments/scratch work
      - ./experiments:/home/dev/experiments
      
      # Optional: mount your dotfiles if you prefer live-editing them
      # - ~/.vimrc:/home/dev/.vimrc:ro
      # - ~/.tmux.conf:/home/dev/.tmux.conf:ro
    
    # GPU support (uncomment if needed)
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: all
    #           capabilities: [gpu]
    
    working_dir: /home/dev/open_spiel

volumes:
  # Named volume for build cache - survives container removal
  build-cache:
